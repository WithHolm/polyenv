name: Main - Release
on:
  workflow_dispatch:
    inputs:
      version_bump:
        description: 'Version bump type'
        type: choice
        required: true
        default: 'patch'
        options:
          - minor
          - patch
  # push:
  #   branches: [ "main" ]
  #   tags:
  #     - "v*.*.*" # Push events to matching v*, i.e. v1.0, v20.15.10

env:
  goreleaser_version: ~> v2
  goreleaser_dist: goreleaser
#   Variables: .github/variables/common.env

name: Build and Release

jobs:
  build:
    name: build
    runs-on: ubuntu-latest
    steps:
      - name: Check for correct repository
        if: ${{ github.event_name != 'workflow_dispatch' && github.repository != 'withholm/polyenv' }}
        run: |
          echo "Should only run in the withholm/polyenv repository"
          exit 1

      - uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version-file: "go.mod"
          cache: true
      
      - name: get latest tag that is v.*.*
        id: get-latest-tag
        run: |
          latest_tag=$(git tag --sort=committerdate | tail -1)
          echo "latest_tag=$latest_tag"
          echo "latest_tag=$latest_tag" >> $GITHUB_OUTPUT

      # - name: Build and release
      #   id: goreleaser
      #   uses: goreleaser/goreleaser-action@v6
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #     CI: true
      #   with:
      #     version: "~> v2"
      #     distribution: goreleaser
      #     args: release --clean
      # - name: Build and release
      #   id: goreleaser
      #   uses: goreleaser/goreleaser-action@v6
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     version: ${{ env.goreleaser_version }}
      #     distribution: ${{ env.goreleaser_dist }}
      #     args: release --clean --verbose --draft



